---
title: "JVM 监控工具 & 调优经验"
layout: post
date: 2019-02-19 10:48
tag:
- JVM
- 调优
category: JVM
author: inotwant
description: 深入理解 Java 虚拟机第四、五章阅读笔记
---

### JVM 命令行参数（HotSpot）

1. jps
	- 作用：显示指定系统内所有的虚拟机进程
	- 说明：`LVMID`(Local Virtual Machine Identifier)，对于本地虚拟机进程来说，它与操作系统的 PID 是一致的
2. jstat
	- 作用：虚拟机统计信息监视攻击
	- 监视信息分为三类：类加载、GC、JIT
3. jinfo
	- 作用：实时查看和调整虚拟机各项参数
4. jmap
	- 作用1：生成 dump 文件
	- 作用2：查看 F-Queue 队列
	- 作用3：查看 堆 的详细信息。比如，使用哪种回收器、参数配置等等
	- 作用4：显示堆中对象统计信息
5. jhat
	- 作用：虚拟机堆转储快照分析工具
6. jstack
	- 作用：生成虚拟机当前时刻的线程快照（`threaddump` or `javacore`）。目的：定位线程长期停顿的原因（死锁、死循环、长期等待外部资源等待）
	- 小技巧：项目中使用 `Thread.getAllStackTraces()` 方法实时查看线程快照，不妨以此做个管理页面
7. HSDIS
	- 作用：获取JIT编译得到的本地代码对应的汇编指令。常用于查看字节码的实现，理解详细性能
	- 环境：需要 make 得到 `hsdis-**.dll`
	- 参考：[在64位Windows上编译hsdis](https://blog.csdn.net/yizishou/article/details/53423409)
	
### JVM 监控可视化工具

1. JConsole
2. VisualVM
	- 不仅可以用来监视、故障处理，还能用来作性能分析
	- 附：BTrace 动态日志跟踪，使用的是代码热替换技术 ★★★

### 调优经验

1. 如何在单个高性能设备上部署 JVM
	- 安装 64位 虚拟机
		- 缺：对大堆的 FullGC 较慢，dump 以及 分析dump 不易，指针膨胀
	- 使用逻辑集群，安装多个虚拟机
		- 缺：全局资源可以成为并发的屏障，由于多个虚拟机多个进程会存在冗余信息
2. 除 *堆* 和 *方法区* 外的其他内存
	- Direct Memory
	- JNI 本地方法栈所占内存
	- **socket 缓存区**：每个 socket 连接都 Receive 和 send 两个缓冲区，分别占大约 37KB 和 25KB 内存
3. 外部命令导致系统缓慢
	- 例如，执行 shell 脚本
	- 经历：毕设中，使用 java 调用 python 使用了 `Runtime.getRuntime().exec()`。它会先 `fork` 虚拟机进程
4. 由 Windows 虚拟内存导致长时间停顿
	- 程序（GUI）在最小化时它的工作内存被自动交换至磁盘的页面文件中，这样在发送 GC 时就有可能因为需要恢复页面文件而导致不支持的 GC 停顿

