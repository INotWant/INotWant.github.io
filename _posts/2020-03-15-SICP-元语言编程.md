---
title: "SICP 元语言" 
layout: post
date: 2020-03-15 16:00
tag:
- sicp lisp
category: sicp
author: inotwant
description: SICP 元语言
---

真正的魔力在于知道哪个咒语有用，在什么时候，用于做什么，其诀窍就在于学会有关的诀窍。

通向珍宝的钥匙就是珍宝！

---

### 大纲

- 什么是元语言编程，元语言编程的目的
- 如何实现元语言编程及优化
- 元语言编程的一些应用实例
  - 惰性求值 -- 正则序Scheme
  - 非确定性计算 -- amb
  - 逻辑程序设计语言 -- query 语言实现

### 1. 了解元语言

语言的基础

- 基本表达式
- 表达式的组合
- 复合

元语言 -- **DSL**

- 创建一种新的语言
- 计算机科学本身不过就是有关如何构造适当的描述语言的学科
- 新语言可能使我们以一种不同的方式，利用不同的**原语**，不同的**组合方式**和**抽象方式**去描述所面对的问题

### 2. 元语言的实现及优化

元语言的实现 -- **求值器**（理论）

- *求值器决定了一个程序设计语言中各种表达式的意义，而它本身也不过就是另一个程序*
- 基本循环
  - 求值组合表达式中的各个子表达式，包括运算符子表达式和一系列运算对象子表达式
  - 将运算对象应用于运算符，包括基本过程和复合过程两种。或者换一句话说，（不考虑基本过程）在将一个复合过程应用于一集实际参数时，我们在一个**新的环境**里求值这个过程的体
- 基本循环是求值过程的核心。在这一循环中，表达式在环境中的求值被归约到过程对实际参数的应用，而这种应用又被归约到新的表达式在新的环境中的求值，如此下去，直至下降到符号（其值可以在环境中找到）或基本过程（它们可以直接应用）

Lisp 为什么适合实现各种求值器

- 操作**符号表达式**的能力

Lisp 求值器的实现

- 核心 -- `eval` & `apply`
  - `eval` -- 根据表达式的类型进行分派
  - `apply` -- 对“过程”进行求值
- 语法抽象 --> 定义表达式的形式，抽象出来可以更方便对表达式形式的修改
- 环境 --> 复合过程的体需要在新的环境中求值，一个环境为由框架组成的表，而框架中保存了符号与相应的值
- 启动 --> 初始化环境 & 驱动循环（读取用户输入，输出求值器结果）

Lisp 求值器实现的优化

- 思想：将语法分析与执行分离
- 实现：将每个（子）表达式都被语法分析为一个执行过程（即用 `lamda` 包装）

附：求值器（任一求值器都能模拟其他的求值器） -->  什么是可计算就与语言无关 --> 可计算性（图灵机）--> 停机问题（图灵机不可计算的）

### 3. 惰性求值 -- 正则序Scheme

目标：

- 实现正则序Scheme
  - Scheme（作为Lisp的一种方言），在它求值时使用的是应用序，也就是在求值一个表达式时先求值各个子表达式的值
  - 正则序Scheme则要求在求值一个表达式时，可直接将其中的运算对象直接带入，在必须求值时才对这些子表达式进行求值
- 在正则序Scheme中，它可完美的支持**流**--惰性求值

实现思路：

- 确定哪些运算对象必须立即求值，哪些可以延时求值
- 确定可延时求值的在何时必须求值，如何去求值 -- 设计一个数据结构“槽”，保存表达式以及环境，以用于后续的求值

附：

- Scheme 中 `delay` `cons-stream` 是一种特殊形式，非过程，也就不能用于高阶过程中
- 在正则序Scheme中实现 `cons` 的延迟求值，通过**消息传递**方式将其描述为过程

### 4. 非确定性计算 -- amb

目标：

- 设计一种程序语言，它自带在解空间中搜索的功能（支持非确定性计算）
- demo
  - 给出各个变量的解空间
  - 给出解对各变量的要求
  - 无需用户实现解空间的搜索算法，此程序语言可以自动的搜索解。如果遇到错误解，则回溯

实现理解：

- 基于上述“优化的Lisp求值器”实现，在其中每个表达式被解析为`lambda`过程，方便回溯
- 在表达式解析完成后，可以想象得到的是一个由一系列小的`lambda`组件组成的一个大`lambda`
- 在表达式解析为`lambda`后，`lambda`中保存了三个约束：`env` `succeed` `fail`，即**环境** **成功继续过程** **失败继续过程**。在执行`lambda`时需要它们
  - 成功继续过程：以表达式执行的结果和失败继续过程为参数，往后传递它们
  - 失败继续过程：在为撤销赋值构建新的失败继续过程中被调用，在`amb`的运算对象为`null`是被调用（`require`通过调用 `(amb)`实现的）

### 5. 逻辑程序设计 -- query

目标：

- 设计一种逻辑程序语言，它支持一些查询操作
  - 基本元素：简单的匹配
  - 组合：not or and lisp-value
  - 复合：规则（包含 **结论** & **规则体**），应用规则的过程可被视为判断“断言”（存入的数据）是否能由规则体推出结论
- 逻辑程序设计的目标就是为程序员提供一种技术，它能将计算问题分解为两个互相分离的问题：“什么需要计算”，以及“如何”进行这一计算
- 逻辑程序语言与**数理逻辑**的关系
  - 逻辑程序语言中的操作只是数理逻辑中那些能够用过程解释（模拟）的

实现思路：（略）

- 框架流
- 两个基本操作
  - 模式匹配
  - 合一